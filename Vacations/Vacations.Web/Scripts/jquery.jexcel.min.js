!function($){var methods={init:function(e){var t={colHeaders:[],colWidths:[],colAlignments:[],columns:[],minSpareRows:0,minSpareCols:0,contextMenu:null,about:"jExcel Spreadsheet\\nVersion 1.0.2\\nAuthor: Paul Hodel <paul.hodel@gmail.com>\\nWebsite: http://www.bossanova.uk/jexcel"},e=$.extend(t,e),l=$(this).prop("id"),n=$(this);prepareTable=function(){$.fn.jexcel.defaults||($.fn.jexcel.defaults=new Array),$.fn.jexcel.defaults[l]=e,$.fn.jexcel.defaults[l].history=new Array,$.fn.jexcel.defaults[l].historyIndex=-1;var t=[];for(e.data||(e.data=[]),$.fn.jexcel.defaults[l].data.length||($.fn.jexcel.defaults[l].data=[[]]),size=e.colHeaders.length,e.data[0].length>size&&(size=e.data[0].length),i=0;i<size;i++)e.colHeaders[i]||(e.colHeaders[i]=$.fn.jexcel("getColumnName",i)),e.columns[i]?e.columns[i]||(e.columns[i].type="text"):e.columns[i]={type:"text"},e.columns[i].source||($.fn.jexcel.defaults[l].columns[i].source=[]),e.columns[i].options||($.fn.jexcel.defaults[l].columns[i].options=[]),e.columns[i].editor||(e.columns[i].editor=null),e.colAlignments[i]||(e.colAlignments[i]="center"),e.colWidths[i]||(e.colWidths[i]="50"),"autocomplete"==e.columns[i].type||"dropdown"==e.columns[i].type?e.columns[i].url&&t.push($.ajax({url:e.columns[i].url,index:i,dataType:"json",success:function(e){$.fn.jexcel.defaults[l].columns[this.index].source=e}})):"calendar"==e.columns[i].type&&($.fn.jexcel.defaults[l].columns[i].options.format||($.fn.jexcel.defaults[l].columns[i].options.format="DD/MM/YYYY"));t.length>0?$.when.apply(this,t).done(function(){$(n).jexcel("createTable")}):$(n).jexcel("createTable")},e.csv?$.csv?(e.delimiter=e.delimiter||",",$.ajax({url:e.csv,success:function(t){var l=$.csv.toArrays(t);1==e.csvHeaders&&(e.colHeaders=l.shift()),e.data=l,prepareTable()}})):console.error("Jexcel error: jquery-csv library not loaded"):prepareTable()},createTable:function(){var e=$(this).prop("id"),l=$.fn.jexcel.defaults[e],n=document.createElement("table");$(n).prop("class","jexcel bossanova-ui"),$(n).prop("cellpadding","0"),$(n).prop("cellspacing","0"),$(n).prop("unselectable","yes"),$(n).prop("onselectstart","return false"),$(n).prop("draggable","false");var c=document.createElement("thead"),s=document.createElement("tbody");$(c).prop("class","jexcel_label");var r='<td width="30" class="jexcel_label"></td>';for(i=0;i<l.colHeaders.length;i++)width=l.colWidths[i],align=l.colAlignments[i],header=l.colHeaders[i],r+="hidden"==l.columns[i].type?'<td id="col-'+i+'" style="display:none;">'+l.colHeaders[i]+"</td>":'<td id="col-'+i+'" width="'+width+'" align="'+align+'">'+header+"</td>";if($(c).html("<tr>"+r+"</tr>"),$(n).append(c),$(n).append(s),$(n).on("dragstart",function(){return!1}),$(this).html(n),!$(".jexcel_corner").length){var a=document.createElement("div");$(a).prop("class","jexcel_corner"),$(a).prop("id","corner");var d=document.createElement("textarea");$(d).prop("class","jexcel_textarea"),$(d).prop("id","textarea");var f=document.createElement("div");$(f).css("display","none"),$(f).prop("class","jexcel_contextmenu"),$(f).prop("id","jexcel_contextmenu");var u=document.createElement("div");$(u).css("display","none"),$(u).html('<a href="http://github.com/paulhodel/jexcel">jExcel Spreadsheet</a>'),$("body").append(a),$("body").append(d),$("body").append(f),$("body").append(u),$(a).on("dragstart",function(){return!1}),$.fn.jexcel.selectedCorner=!1,$.fn.jexcel.selectedHeader=null,$.fn.jexcel.resizeColumn=null,$(document).on("contextmenu",function(e){var t=$(e.target).parent().parent().parent();if($(t).is(".jexcel")){var n=$(e.target).prop("id");n&&(n=n.split("-"),contextMenuContent="","function"==typeof l.contextMenu?contextMenuContent=l.contextMenu(n[0],n[1]):$(e.target).parent().parent().is("thead")?contextMenuContent="<a onclick=\"$('#"+$.fn.jexcel.current+"').jexcel('orderBy', "+n[1]+', 0)">Order ascending <span></span></a><a onclick="$(\'#'+$.fn.jexcel.current+"').jexcel('orderBy', "+n[1]+', 1)">Order descending <span></span></a><hr><a onclick="$(\'#'+$.fn.jexcel.current+"').jexcel('insertColumn', 1, null, "+n[1]+')">Insert a new column<span></span></a><a onclick="$(\'#'+$.fn.jexcel.current+"').jexcel('insertRow', 1, "+n[1]+')">Insert a new row<span></span></a><hr><a onclick="$(\'#'+$.fn.jexcel.current+"').jexcel('download')\">Save as...<span>Ctrl + S</span></a><a onclick=\"alert('"+l.about+"')\">About<span></span></a>":$(e.target).parent().parent().is("tbody")&&(contextMenuContent="<a onclick=\"$('#"+$.fn.jexcel.current+"').jexcel('insertColumn', 1, null, "+n[1]+')">Insert a new column<span></span></a><a onclick="$(\'#'+$.fn.jexcel.current+"').jexcel('insertRow', 1, "+n[1]+')">Insert a new row<span></span></a><hr><a onclick="$(\'#'+$.fn.jexcel.current+"').jexcel('download')\">Save as...<span>Ctrl + S</span></a><a onclick=\"alert('"+l.about+"')\">About<span></span></a>"),contextMenuContent&&($("#jexcel_contextmenu").html(contextMenuContent),$("#jexcel_contextmenu").css({display:"block",top:event.pageY+"px",left:event.pageX+"px"}),e.preventDefault()))}}),$(document).on(" mousewheel",function(e){$(".jexcel_contextmenu").css("display","none")}),$(document).on("mousedown",function(e){if("corner"==e.target.id)$.fn.jexcel.selectedCorner=!0;else{var t=$(e.target).parent().parent().parent();if($(t).is(".jexcel")){var l=$(t).parent().prop("id");if($.fn.jexcel.current&&$.fn.jexcel.current!=l&&$("#"+$.fn.jexcel.current).find("td").removeClass("selected highlight highlight-top highlight-left highlight-right highlight-bottom"),$.fn.jexcel.current=l,$(e.target).parent().parent().is("thead")){var n=$(e.target).prop("id");if(n){if(n=n.split("-"),$.fn.jexcel.selectedHeader&&(e.shiftKey||e.ctrlKey))var c=$($.fn.jexcel.selectedHeader).prop("id").split("-");else{var c=$(e.target).prop("id").split("-");$.fn.jexcel.selectedHeader=$(e.target)}if($(e.target).outerWidth()-e.offsetX<8)$.fn.jexcel.resizeColumn={mousePosition:e.pageX,column:n[1],width:parseInt($(e.target).css("width"))},$(t).parent().find(".c"+n[1]).addClass("resizing"),$(t).parent().find("#col-"+n[1]).addClass("resizing"),$("#"+$.fn.jexcel.current).jexcel("updateSelection"),$(".jexcel_corner").css("left","-200px");else{var i=$("#"+$.fn.jexcel.current).find("#"+n[1]+"-0"),s=$("#"+$.fn.jexcel.current).find("#"+c[1]+"-"+parseInt($.fn.jexcel.defaults[$.fn.jexcel.current].data.length-1));$("#"+$.fn.jexcel.current).jexcel("updateSelection",i,s)}}}else $.fn.jexcel.selectedHeader=!1;if($(e.target).parent().parent().is("tbody"))if($(e.target).is(".jexcel_label")){var n=$(e.target).prop("id").split("-");if($.fn.jexcel.selectedRow&&(e.shiftKey||e.ctrlKey))var c=$($.fn.jexcel.selectedRow).prop("id").split("-");else{var c=$(e.target).prop("id").split("-");$.fn.jexcel.selectedRow=$(e.target)}var i=$("#"+$.fn.jexcel.current).find("#0-"+n[1]),s=$("#"+$.fn.jexcel.current).find("#"+parseInt($.fn.jexcel.defaults[$.fn.jexcel.current].columns.length-1)+"-"+c[1]);$("#"+$.fn.jexcel.current).jexcel("updateSelection",i,s)}else $($.fn.jexcel.selectedCell).hasClass("edition")?$(e.target)!=$.fn.jexcel.selectedCell&&($.fn.jexcel.selectedCell=$(e.target),$("#"+$.fn.jexcel.current).jexcel("updateSelection",$.fn.jexcel.selectedCell,$(e.target))):($.fn.jexcel.selectedCell&&e.shiftKey||($.fn.jexcel.selectedCell=$(e.target)),$("#"+$.fn.jexcel.current).jexcel("updateSelection",$.fn.jexcel.selectedCell,$(e.target))),$.fn.jexcel.selectedRow=null}else $(e.target).parents(".jexcel").length||($.fn.jexcel.current&&$("#"+$.fn.jexcel.current).find("td").removeClass("selected highlight highlight-top highlight-left highlight-right highlight-bottom"),$(a).css("top","-200px"),$(a).css("left","-200px"),$.fn.jexcel.current=null,$.fn.jexcel.selectedCell=null,$.fn.jexcel.selectedRow=null,$.fn.jexcel.selectedHeader=null)}}),$(document).on("mouseup",function(e){$("#jexcel_contextmenu").css("display","none"),$.fn.jexcel.selectedCorner=!1,$.fn.jexcel.resizeColumn&&($("#"+$.fn.jexcel.current).find("thead td").removeClass("resizing"),$("#"+$.fn.jexcel.current).find("tbody td").removeClass("resizing"),$.fn.jexcel.resizeColumn=null);var t=$("#"+$.fn.jexcel.current).find("tbody td.selection");if($(t).length>0){var e=$(t[0]).prop("id").split("-"),l=$(t[t.length-1]).prop("id").split("-");$("#"+$.fn.jexcel.current).jexcel("copyData",e,l),$(t).removeClass("selection selection-left selection-right selection-top selection-bottom")}}),$(document).on("dblclick",function(e){if($.fn.jexcel.current){if("corner"==e.target.id){var t=$("#"+$.fn.jexcel.current).find("tbody td.highlight");if("object"==typeof t){var l=$(t[0]).prop("id").split("-"),n=$(t[t.length-1]).prop("id").split("-");l[1]=parseInt(n[1])+1,n[1]=parseInt($.fn.jexcel.defaults[$.fn.jexcel.current].data.length),$("#"+$.fn.jexcel.current).jexcel("copyData",l,n)}}if($(e.target).parent().parent().is("thead")){var l=$(e.target).prop("id");l&&(l=$(e.target).prop("id").split("-"),$("#"+$.fn.jexcel.current).jexcel("orderBy",l[1]))}$(e.target).is(".highlight")&&$("#"+$.fn.jexcel.current).jexcel("openEditor",$(e.target))}}),$(document).on("mousemove",function(e){if($.fn.jexcel.resizeColumn){var t=e.pageX-$.fn.jexcel.resizeColumn.mousePosition;$.fn.jexcel.resizeColumn.width+t>0&&$("#"+$.fn.jexcel.current).jexcel("setWidth",$.fn.jexcel.resizeColumn.column,$.fn.jexcel.resizeColumn.width+t)}else $(e.target).parent().parent().is("thead")&&($(e.target).outerWidth()-e.offsetX<8?$(e.target).css("cursor","col-resize"):$(e.target).css("cursor",""))}),$(document).on("mouseover",function(e){if(!$.fn.jexcel.resizeColumn){var t=$(e.target).closest(".jexcel");if($.fn.jexcel.current==$(t).parent().prop("id")){if($(e.target).parent().parent().is("thead")&&$.fn.jexcel.selectedHeader&&e.buttons){var l=$($.fn.jexcel.selectedHeader).prop("id"),n=$(e.target).prop("id");if(l&&n){l=l.split("-"),n=n.split("-");var c=$("#"+$.fn.jexcel.current).find("#"+l[1]+"-0"),i=$("#"+$.fn.jexcel.current).find("#"+n[1]+"-"+parseInt($.fn.jexcel.defaults[$.fn.jexcel.current].data.length-1));$("#"+$.fn.jexcel.current).jexcel("updateSelection",c,i)}}if($(e.target).parent().parent().is("tbody"))if($(e.target).is(".jexcel_label")){if($.fn.jexcel.selectedRow&&e.buttons){var l=$($.fn.jexcel.selectedRow).prop("id"),n=$(e.target).prop("id");if(l&&n){l=l.split("-"),n=n.split("-");var c=$("#"+$.fn.jexcel.current).find("#0-"+l[1]),i=$("#"+$.fn.jexcel.current).find("#"+parseInt($.fn.jexcel.defaults[$.fn.jexcel.current].columns.length-1)+"-"+n[1]);$("#"+$.fn.jexcel.current).jexcel("updateSelection",c,i)}}}else $.fn.jexcel.selectedCell&&($($.fn.jexcel.selectedCell).hasClass("edition")||(1==$.fn.jexcel.selectedCorner?$("#"+$.fn.jexcel.current).jexcel("updateCornerSelection",$(e.target)):e.buttons&&$("#"+$.fn.jexcel.current).jexcel("updateSelection",$.fn.jexcel.selectedCell,$(e.target))))}}}),$(document).on("copy",function(e){$.fn.jexcel.current&&$("#"+$.fn.jexcel.current).jexcel("copy",!0)}),$(document).on("cut",function(){$.fn.jexcel.current&&$("#"+$.fn.jexcel.current).jexcel("cut")}),$(document).on("paste",function(e){$.fn.jexcel.current&&$("#"+$.fn.jexcel.current).jexcel("paste",$.fn.jexcel.selectedCell,e.originalEvent.clipboardData.getData("text"))});var p=null;$(document).keydown(function(e){if($.fn.jexcel.current){var l=null;$.fn.jexcel.selectedCell&&(columnId=$($.fn.jexcel.selectedCell).prop("id").split("-"),37==e.which?($($.fn.jexcel.selectedCell).hasClass("edition")||(l=e.ctrlKey?$($.fn.jexcel.selectedCell).parent().find("td").not(".jexcel_label").first():$($.fn.jexcel.selectedCell).prev()),e.preventDefault()):39==e.which?($($.fn.jexcel.selectedCell).hasClass("edition")||(l=e.ctrlKey?$($.fn.jexcel.selectedCell).parent().find("td").last():$($.fn.jexcel.selectedCell).next()),e.preventDefault()):38==e.which?($($.fn.jexcel.selectedCell).hasClass("edition")||(l=e.ctrlKey?$($.fn.jexcel.selectedCell).parent().parent().find("tr").first().find("#"+columnId[0]+"-0"):$($.fn.jexcel.selectedCell).parent().prev().find("#"+columnId[0]+"-"+(columnId[1]-1))),e.preventDefault()):40==e.which?($($.fn.jexcel.selectedCell).hasClass("edition")||(l=e.ctrlKey?$($.fn.jexcel.selectedCell).parent().parent().find("tr").last().find("#"+columnId[0]+"-"+($.fn.jexcel.defaults[$.fn.jexcel.current].data.length-1)):$($.fn.jexcel.selectedCell).parent().next().find("#"+columnId[0]+"-"+(parseInt(columnId[1])+1))),e.preventDefault()):27==e.which?$($.fn.jexcel.selectedCell).hasClass("edition")&&$("#"+$.fn.jexcel.current).jexcel("closeEditor",$($.fn.jexcel.selectedCell),!1):13==e.which?($($.fn.jexcel.selectedCell).hasClass("edition")&&("calendar"==$.fn.jexcel.defaults[$.fn.jexcel.current].columns[columnId[0]].type?$("#"+$.fn.jexcel.current).find("editor").jcalendar("close",1):$("#"+$.fn.jexcel.current).jexcel("closeEditor",$($.fn.jexcel.selectedCell),!0)),columnId[1]==$.fn.jexcel.defaults[$.fn.jexcel.current].data.length-1&&$("#"+$.fn.jexcel.current).jexcel("insertRow"),l=$($.fn.jexcel.selectedCell).parent().next().find("#"+columnId[0]+"-"+(parseInt(columnId[1])+1)),e.preventDefault()):9==e.which?($($.fn.jexcel.selectedCell).hasClass("edition")&&("calendar"==$.fn.jexcel.defaults[$.fn.jexcel.current].columns[columnId[0]].type?$("#"+$.fn.jexcel.current).find("editor").jcalendar("close",1):$("#"+$.fn.jexcel.current).jexcel("closeEditor",$($.fn.jexcel.selectedCell),!0)),columnId[0]==$.fn.jexcel.defaults[$.fn.jexcel.current].data[0].length-1&&$("#"+$.fn.jexcel.current).jexcel("insertColumn"),$($.fn.jexcel.selectedCell).hasClass("edition")||(l=$($.fn.jexcel.selectedCell).next()),e.preventDefault()):46==e.which?$($.fn.jexcel.selectedCell).hasClass("edition")||$("#"+$.fn.jexcel.current).jexcel("setValue",$("#"+$.fn.jexcel.current).find(".highlight"),""):e.shiftKey||e.ctrlKey?!e.shiftKey&&e.ctrlKey&&(65==e.which?(t=$(this).find(".jexcel tbody td").not(".jexcel_label"),o=$(t).first(),t=$(t).last(),$("#"+$.fn.jexcel.current).jexcel("updateSelection",o,t),e.preventDefault()):83==e.which?($("#"+$.fn.jexcel.current).jexcel("download"),e.preventDefault()):89==e.which?($($.fn.jexcel.selectedCell).hasClass("edition")||$("#"+$.fn.jexcel.current).jexcel("redo"),e.preventDefault()):90==e.which&&($($.fn.jexcel.selectedCell).hasClass("edition")||$("#"+$.fn.jexcel.current).jexcel("undo"),e.preventDefault())):$.fn.jexcel.selectedCell&&"readonly"!=$.fn.jexcel.defaults[$.fn.jexcel.current].columns[columnId[0]].type&&($($.fn.jexcel.selectedCell).hasClass("edition")||/[a-zA-Z0-9]/.test(String.fromCharCode(e.keyCode))&&$("#"+$.fn.jexcel.current).jexcel("openEditor",$($.fn.jexcel.selectedCell),!0)),l&&$(l).length>0&&"row"!=$(l).prop("id").substr(0,3)&&(e.shiftKey?(p||(p=$.fn.jexcel.selectedCell),o=p):e.ctrlKey?(p=null,o=l):(p=null,o=l),t=l,$.fn.jexcel.selectedCell=l,$(l).focus(),$("#"+$.fn.jexcel.current).jexcel("updateSelection",o,t)))}})}$(this).jexcel("setData")},setData:function(e){var t=$(this).prop("id");e&&("string"==typeof e&&(e=JSON.parse(e)),$.fn.jexcel.defaults[t].data=e),$.fn.jexcel.defaults[t].dynamicColumns=[];var l=$(this).find("tbody");for($(l).html(""),j=0;j<$.fn.jexcel.defaults[t].data.length;j++){for(tr=document.createElement("tr"),$(tr).append('<td id="row-'+j+'" class="jexcel_label">'+parseInt(j+1)+"</td>"),i=0;i<$.fn.jexcel.defaults[t].colHeaders.length;i++)td=$(this).jexcel("createCell",i,j),$(tr).append(td);$(l).append(tr)}$.fn.jexcel.defaults[t].dynamicColumns.length>0&&$(this).jexcel("formula"),"function"==typeof $.fn.jexcel.defaults[t].onload&&$.fn.jexcel.defaults[t].onload($(this))},updateSettings:function(e){var t=$(this).prop("id");if(e||$.fn.jexcel.defaults[t].updateSettingsOptions&&(e=$.fn.jexcel.defaults[t].updateSettingsOptions),"object"==typeof e){$.fn.jexcel.defaults[t].updateSettingsOptions=e;var l=$(this).find(".jexcel tbody td").not(".jexcel_label");"function"==typeof e.cells&&$.each(l,function(l,n){t=$(n).prop("id").split("-"),e.cells($(n),t[0],t[1])})}},openEditor:function(e,t){var l=$(this).prop("id"),n=$(this),c=$.fn.jexcel.defaults[l],s=$(e).prop("id").split("-");if(1==$(e).hasClass("readonly"));else if($.fn.jexcel.edition=$(e).html(),$(this).jexcel("startNewHistoryRecord"),c.columns[s[0]].editor)$(e).addClass("edition"),c.columns[s[0]].editor.openEditor(e);else if("checkbox"==c.columns[s[0]].type||"hidden"==c.columns[s[0]].type);else if("dropdown"==c.columns[s[0]].type){if($(e).addClass("edition"),"function"==typeof c.columns[s[0]].filter)var r=c.columns[s[0]].filter($(this),$(e),s[0],s[1],c.columns[s[0]].source);else var r=c.columns[s[0]].source;var a="<select>";for(i=0;i<r.length;i++)"object"==typeof r[i]?(k=r[i].id,v=r[i].name):(k=r[i],v=r[i]),a+='<option value="'+k+'">'+v+"</option>";a+="</select>";var o=$(e).find("input").val();$(e).html(a);var d=$(e).find("select");$(d).change(function(){$(n).jexcel("closeEditor",$(this).parent(),!0)}),$(d).blur(function(){$(n).jexcel("closeEditor",$(this).parent(),!0)}),$(d).focus(),o&&$(d).val(o)}else if("calendar"==c.columns[s[0]].type){$(e).addClass("edition");var o=$(e).find("input").val(),d=document.createElement("input");$(d).prop("class","editor"),$(d).css("width",$(e).width()),$(d).val($(e).text()),$(e).html(d),$(e).find(""),$(e).focus(),c.columns[s[0]].options.onclose=function(){$(n).jexcel("closeEditor",$(e),!0)},$(d).jcalendar(c.columns[s[0]].options),$(d).jcalendar("open",o)}else if("autocomplete"==c.columns[s[0]].type){$(e).addClass("edition");var a=$(e).text(),o=$(e).find("input").val(),d=document.createElement("input");$(d).prop("class","editor"),$(d).css("width",$(e).width());var f=document.createElement("div");$(f).prop("class","results"),a?$(f).html('<li id="'+o+'">'+a+"</li>"):$(f).css("display","none");var u=null;$(d).on("keyup",function(){var t=$(this).val();u&&clearTimeout(u),u=setTimeout(function(){$(f).html(""),showResult=function(t,c){$.each(t,function(t,i){"object"==typeof i?(name=i.name,l=i.id):(name=i,l=i),-1!=name.toLowerCase().indexOf(c.toLowerCase())&&(li=document.createElement("li"),$(li).prop("id",l),$(li).html(name),$(li).mousedown(function(t){$(e).html(this),$(n).jexcel("closeEditor",$(e),!0)}),$(f).append(li))}),$(f).html()||$(f).html('<div style="padding:6px;">No result found</div>'),$(f).css("display","")},c.columns[s[0]].url?$.getJSON(c.columns[s[0]].url+"?q="+t+"&r="+$(n).jexcel("getRowData",s[1]),function(e){showResult(e,t)}):c.columns[s[0]].source&&showResult(c.columns[s[0]].source,t)},500)}),$(e).html(d),$(e).append(f),$(d).focus(),$(d).val(""),$(d).blur(function(){$(n).jexcel("closeEditor",$(e),!1)})}else{$(e).addClass("edition");var p=$(e).find("input");if($(p).length)var a=$(p).val();else var a=$(e).html();var d=document.createElement("input");$(d).prop("class","editor"),$(d).css("width",$(e).width()),$(e).html(d),c.columns[s[0]].mask&&($.fn.masked?$(d).mask(c.columns[s[0]].mask,c.columns[s[0]].options):console.error("Jexcel: it was not possible to load the mask plugin.")),$(d).focus(),t||$(d).val(a),$(d).blur(function(){$(n).jexcel("closeEditor",$(this).parent(),!0)})}},closeEditor:function(e,t){$(e).removeClass("edition");var l=$(this).prop("id"),n=$.fn.jexcel.defaults[l],c=$(e).prop("id").split("-");if(1==t){if("function"==typeof n.columns[c[0]].onbeforechange&&n.columns[c[0]].onbeforechange($(this),$(e)),n.columns[c[0]].editor)n.columns[c[0]].editor.closeEditor(e,t);else if("checkbox"==n.columns[c[0]].type||"hidden"==n.columns[c[0]].type);else if("dropdown"==n.columns[c[0]].type){var i=$(e).find("select").val(),s=$(e).find("select").find("option:selected").text();$(e).html('<input type="hidden" value="'+i+'">'+s)}else if("autocomplete"==n.columns[c[0]].type){var r=$(e).find("li");if(r.length>0){var i=$(e).find("li").prop("id"),s=$(e).find("li").html();$(e).html('<input type="hidden" value="'+i+'">'+s)}else $(e).html("")}else if("calendar"==n.columns[c[0]].type){var i=$(e).find(".jcalendar_value").val(),s=$(e).find(".jcalendar_input").val();$(e).html('<input type="hidden" value="'+i+'">'+s)}else{var i=$(e).find(".editor").val();"="==i.substr(0,1)&&-1==$.fn.jexcel.defaults[l].dynamicColumns.indexOf($(e).prop("id"))&&$.fn.jexcel.defaults[l].dynamicColumns.push($(e).prop("id")),$(e).html(i)}$(this).jexcel("storeCellChange",e,i,$.fn.jexcel.edition),$.fn.jexcel.defaults[l].data[c[1]][c[0]]=$(this).jexcel("getValue",$(e)),"function"==typeof n.onchange&&n.onchange($(this),$(e),i),$(this).jexcel("afterChange"),n.minSpareCols>0&&c[0]==$.fn.jexcel.defaults[l].data[0].length-1&&$("#"+$.fn.jexcel.current).jexcel("insertColumn",n.minSpareCols),n.minSpareRows>0&&c[1]==$.fn.jexcel.defaults[l].data.length-1&&$("#"+$.fn.jexcel.current).jexcel("insertRow",n.minSpareRows)}else"calendar"==n.columns[c[0]].type||($(e).html($.fn.jexcel.edition),$.fn.jexcel.edition=null),$(this).jexcel("discardCurrentHistoryRecord")},getValue:function(e){var t=null;if("object"!=typeof e&&(e=$(this).jexcel("getIdFromColumnName",e),e=$(this).find("[id="+e+"]")),$(e).length){var l=$(this).prop("id"),n=$.fn.jexcel.defaults[l],c=$(e).prop("id").split("-");n.columns[c[0]].editor?t=n.columns[c[0]].editor.getValue(e):"checkbox"==n.columns[c[0]].type?t=$(e).find("input").is(":checked")?"1":"0":"dropdown"==n.columns[c[0]].type||"autocomplete"==n.columns[c[0]].type||"calendar"==n.columns[c[0]].type?t=$(e).find("input").val():"currency"==n.columns[c[0]].type?t=$(e).html().replace(/\D/g,""):(t=$(e).find("input"),t=$(t).length?$(t).val():$(e).html())}return t},setValue:function(e,t,l,n){if("object"!=typeof e&&(e=$(this).jexcel("getIdFromColumnName",e),e=$(this).find("[id="+e+"]")),$(e).length){var c=$(this).prop("id"),i=$(this),s=$.fn.jexcel.defaults[c];return l||n||$(i).jexcel("startNewHistoryRecord"),$.each(e,function(n,r){var a=$(r).prop("id").split("-");if(l||($(i).jexcel("storeCellChange",$(r),t),"function"==typeof s.columns[a[0]].onbeforechange&&s.columns[a[0]].onbeforechange($(this),$(r))),s.columns[a[0]].editor)s.columns[a[0]].editor.setValue(r,t);else if(1==$(r).hasClass("readonly"))t=null;else if("checkbox"==s.columns[a[0]].type)1==t||1==t?$(r).find("input").prop("checked",!0):$(r).find("input").prop("checked",!1);else if("dropdown"==s.columns[a[0]].type||"autocomplete"==s.columns[a[0]].type){if(key="",val="",t){var o=[],d=s.columns[a[0]].source;for(num=0;num<d.length;num++)"object"==typeof d[num]?o[d[num].id]=d[num].name:o[d[num]]=d[num];o[t]?(key=t,val=o[t]):t=null}$(r).html('<input type="hidden" value="'+key+'">'+val)}else"calendar"==s.columns[a[0]].type?(val="","undefined"!=t?val=$.fn.jcalendar("label",t):val="",$(r).html('<input type="hidden" value="'+t+'">'+val)):(t&&"="==t.substr(0,1)&&-1==$.fn.jexcel.defaults[c].dynamicColumns.indexOf($(e).prop("id"))&&$.fn.jexcel.defaults[c].dynamicColumns.push($(e).prop("id")),$(r).html(t));$.fn.jexcel.defaults[c].data[a[1]][a[0]]=t,l||"function"==typeof s.onchange&&s.onchange($(this),$(r),t)}),l||$(this).jexcel("afterChange"),!0}return!1},updateSelection:function(e,t){var l=$(this),n=$(this).find("tbody td"),c=$(this).find("thead td");if($(n).removeClass("highlight"),$(n).removeClass("highlight-left"),$(n).removeClass("highlight-right"),$(n).removeClass("highlight-top"),$(n).removeClass("highlight-bottom"),$(c).removeClass("selected"),$(n).removeClass("selected"),e&&t)for($(e).addClass("selected"),e=$(e).prop("id").split("-"),t=$(t).prop("id").split("-"),parseInt(e[0])<parseInt(t[0])?(px=parseInt(e[0]),ux=parseInt(t[0])):(px=parseInt(t[0]),ux=parseInt(e[0])),parseInt(e[1])<parseInt(t[1])?(py=parseInt(e[1]),uy=parseInt(t[1])):(py=parseInt(t[1]),uy=parseInt(e[1])),i=px;i<=ux;i++)for(j=py;j<=uy;j++)$(this).find("#"+i+"-"+j).addClass("highlight"),$(this).find("#"+px+"-"+j).addClass("highlight-left"),$(this).find("#"+ux+"-"+j).addClass("highlight-right"),$(this).find("#"+i+"-"+py).addClass("highlight-top"),$(this).find("#"+i+"-"+uy).addClass("highlight-bottom"),$(l).find("#col-"+i).addClass("selected"),$(l).find("#row-"+j).addClass("selected");$(this).jexcel("updateCornerPosition")},updateCornerSelection:function(e){var t=($(this),$(this).find("tbody td"));$(t).removeClass("selection"),$(t).removeClass("selection-left"),$(t).removeClass("selection-right"),$(t).removeClass("selection-top"),$(t).removeClass("selection-bottom");var l=$(this).find("tbody td.highlight"),n=$(l[0]).prop("id").split("-"),c=$(l[l.length-1]).prop("id").split("-"),s=$(e).prop("id").split("-");if(s[1]>c[1]||s[1]<n[1]){var r=parseInt(n[0]),a=parseInt(c[0]);if(parseInt(s[1])>parseInt(c[1]))var o=parseInt(c[1])+1,d=parseInt(s[1]);else var o=parseInt(s[1]),d=parseInt(n[1])-1}else if(s[0]>c[0]||s[0]<n[0]){var o=parseInt(n[1]),d=parseInt(c[1]);if(parseInt(s[0])>parseInt(c[0]))var r=parseInt(c[0])+1,a=parseInt(s[0]);else var r=parseInt(s[0]),a=parseInt(n[0])-1}for(j=o;j<=d;j++)for(i=r;i<=a;i++)$(this).find("#"+i+"-"+j).addClass("selection"),$(this).find("#"+i+"-"+o).addClass("selection-top"),$(this).find("#"+i+"-"+d).addClass("selection-bottom"),$(this).find("#"+r+"-"+j).addClass("selection-left"),$(this).find("#"+a+"-"+j).addClass("selection-right")},updateCornerPosition:function(){var e=$(this).find(".highlight");if($(e).length){corner=$(e).last();var t=parseInt($(corner).offset().top)+$(corner).height()+5,l=parseInt($(corner).offset().left)+$(corner).width()+5;$(".jexcel_corner").css("top",t),$(".jexcel_corner").css("left",l)}},getRowData:function(e){e=$(this).find("#row-"+e).parent().find("td").not(":first");var t="";if(e.length>0)for(i=0;i<e.length;i++)t+=$(this).jexcel("getValue",$(e)[i])+",";return t},getData:function(e){var t=[],l=0,n=0,c=$(this).find("thead tr td").not(":first").length,s=$(this).find("tbody tr").length;for(j=0;j<s;j++){for(l=0,i=0;i<c;i++)cell=$(this).find("#"+i+"-"+j),(!e||$(cell).hasClass("highlight"))&&(t[n]||(t[n]=[]),t[n][l]=$(this).jexcel("getValue",$(cell)),l++);l>0&&n++}return t},copy:function(e,t,l){t||(t="	");var n="",c="",s="",r=!1,a=!1,o=$(this).find("thead tr td").not(":first").length,d=$(this).find("tbody tr").length;for(j=0;j<d;j++){for(c="",r=!1,i=0;i<o;i++)cell=$(this).find("#"+i+"-"+j),(!e||$(cell).hasClass("highlight"))&&(r&&(c+=t),s=$(this).jexcel("getValue",$(cell)),s.match(/,/g)&&(s='"'+s+'"'),c+=s,r=!0);c&&(a&&(n+="\n"),n+=c,a=!0)}return l||(txt=$(".jexcel_textarea"),$(txt).val(n),$(txt).select(),document.execCommand("copy")),n},cut:function(){$(this);$(this).jexcel("copy",!0);var e=$(this).find(".highlight");$(this).jexcel("setValue",e,"")},paste:function(e,t){var l=$(this).prop("id");t=t.split("\r\n");var n=$(e).prop("id");if(n){n=n.split("-");var c=parseInt(n[0]),s=parseInt(n[1]);for(s+t.length>$.fn.jexcel.defaults[l].data.length&&$(this).jexcel("insertRow",s+t.length-$.fn.jexcel.defaults[l].data.length),t[0]&&(row=t[0].split("	"),c+row.length>$.fn.jexcel.defaults[l].data[s].length&&$(this).jexcel("insertColumn",c+row.length-$.fn.jexcel.defaults[l].data[s].length)),$(this).jexcel("startNewHistoryRecord"),j=0;j<t.length;j++)for(row=t[j].split("	"),i=0;i<row.length;i++)e=$(this).find("#"+(parseInt(i)+parseInt(c))+"-"+(parseInt(j)+parseInt(s))),$(e).length>0&&$(this).jexcel("setValue",$(e),row[i],!1,!0)}},insertColumn:function(e,t,l){var n=$(this),c=$(this).prop("id");e||(e=1);var s={column:{type:"text"},width:"50",align:"center"};t=$.extend(s,t);var r=$.fn.jexcel.defaults[c],a=r.colHeaders.length;for(i=a;i<a+e;i++){r.colHeaders[i]=t.header||$.fn.jexcel("getColumnName",i),r.colWidths[i]=t.width,r.colAlignments[i]=t.align,r.columns[i]=t.column,r.columns[i].source||($.fn.jexcel.defaults[c].columns[i].source=[]),r.columns[i].options||($.fn.jexcel.defaults[c].columns[i].options=[]),width=r.colWidths[i],align=r.colAlignments[i],header=r.colHeaders[i];var o='<td id="col-'+i+'" width="'+width+'" align="'+align+'">'+header+"</td>",d=$(this).find("thead.jexcel_label tr")[0];$(d).append(o),d=$(this).find("table > tbody > tr"),$.each(d,function(e,t){r.data[e][i]="",o=$(n).jexcel("createCell",i,e),$(t).append(o)})}},insertRow:function(e,t){var l=$(this).prop("id");$.fn.jexcel.defaults[l];for(e||(e=1),j=parseInt($.fn.jexcel.defaults[l].data.length),row=0;row<e;row++){for(tr=document.createElement("tr"),$(tr).append('<td id="row-'+j+'" class="jexcel_label">'+parseInt(j+1)+"</td>"),$.fn.jexcel.defaults[l].data[j]=[],i=0;i<$.fn.jexcel.defaults[l].colHeaders.length;i++)$.fn.jexcel.defaults[l].data[j][i]="",td=$(this).jexcel("createCell",i,j),$(tr).append(td);$(this).find("tbody").append(tr),j++}},setWidth:function(e,t){if(t>0){"object"==typeof e&&(e=$(e).prop("id").split("-"),e=e[0]);var l=$(this).find("thead #col-"+e);l.length&&$(l).prop("width",t)}},getWidth:function(e){"object"==typeof e&&(e=$(e).prop("id").split("-"),e=e[0]);var t=$(this).find("thead #col-"+e);return t.length?$(t).prop("width"):void 0},setHeader:function(e,t){if(t){var l=$(this).find("thead #col-"+e);l.length&&$(l).html(t)}},setSource:function(e,t){"object"==typeof e&&(e=$(e).prop("id").split("-"),e=e[0]);var l=$(this).prop("id");$.fn.jexcel.defaults[l].columns[e].source=t},afterChange:function(){var e=$(this).prop("id");$.fn.jexcel.defaults[e].dynamicColumns.length>0&&$(this).jexcel("formula"),"function"==typeof $.fn.jexcel.defaults[e].onafterchange&&$.fn.jexcel.defaults[e].onafterchange($(this)),$(this).jexcel("updateSettings")},copyData:function(e,t){var l=$(this).jexcel("getData",!0);$(this).jexcel("startNewHistoryRecord");var n=parseInt(e[0]),c=parseInt(t[0]),s=parseInt(e[1]),r=parseInt(t[1]),a=0,o=0;for(j=s;j<=r;j++){for(void 0==l[o]&&(o=0),a=0,i=n;i<=c;i++)void 0==l[o]?a=0:void 0==l[o][a]&&(a=0),cell=$(this).find("#"+i+"-"+j),$(cell).hasClass("readonly")||$(this).jexcel("setValue",cell,l[o][a],!1,!0),a++;o++}},orderBy:function(e,t){if(e>=0){var l=$(this).find("thead").first();if("0"!=t&&"1"!=t){var n=$(l).find(".arrow-down");t=$(n).length>0?1:0}$(l).find(".arrow-down").remove(),$(l).find(".arrow-up").remove(),$(l).find("td").css("text-decoration","none"),1==t?$(l).find("#col-"+e).append('<span class="arrow-up"></span>').css("text-decoration","underline"):$(l).find("#col-"+e).append('<span class="arrow-down"></span>').css("text-decoration","underline"),$(".jexcel_corner").css("top","-200px"),$(".jexcel_corner").css("left","-200px");var c=$(this).prop("id"),i=$.fn.jexcel.defaults[c];Array.prototype.sortBy=function(e,t){return this.slice(0).sort(function(l,n){return t?l[e]>n[e]?-1:l[e]<n[e]?1:0:l[e]>n[e]?1:l[e]<n[e]?-1:0})};var s=i.data.sortBy(e,t);return $(this).jexcel("setData",s),!0}},formula:function(){var main=$(this),id=$(this).prop("id");if($.fn.jexcel.defaults[id].formulas){var formulas=$.fn.jexcel.defaults[id].formulas;$.fn.jexcel.defaults[id].formulas.instance=this}var columns=$.fn.jexcel.defaults[id].dynamicColumns,varibles=$(this).find(".jexcel tbody td").not(".jexcel_label");$.each(varibles,function(e,t){i=$(main).jexcel("getColumnNameFromId",$(t).prop("id")),t=$(main).jexcel("getValue",$(t)),t==parseInt(t)?window[i]=parseInt(t):window[i]=t}),"object"==typeof excelFormulaUtilities?$.each(columns,function(k,column){formula=$(main).jexcel("getValue",column),formula&&"="==formula.substr(0,1)?(value=excelFormulaUtilities.formula2JavaScript(formula),value=eval(value),null===value||isNaN(value)?($(main).find("#"+column).addClass("error"),value='<input type="hidden" value="'+formula+'">#ERROR',$(main).find("#"+column).html(value)):($(main).find("#"+column).removeClass("error"),value='<input type="hidden" value="'+formula+'">'+value,$(main).find("#"+column).html(value))):($(main).find("#"+column).removeClass("error"),columns.splice(k,1))}):console.error("excelFormulaUtilities lib not included")},helper:function(e){var t=[];if("object"==typeof e&&"createEmptyData"==e.action){var l=e.cols||10,n=e.rows||100;for(j=0;j<n;j++)for(t[j]=[],i=0;i<l;i++)t[j][i]=""}return t},download:function(){var e=$(this).prop("id"),t=$.fn.jexcel.defaults[e],l="";1==t.csvHeaders&&(l=t.colHeaders.join()+"\n"),l+=$(this).jexcel("copy",!1,",",!0);var n=document.createElement("a"),c=new Blob([l],{type:"text/csv;charset=utf-8;"}),i=URL.createObjectURL(c);n.href=i,n.setAttribute("download","jexcelTable.csv"),n.click()},startNewHistoryRecord:function(){var e=$(this).prop("id"),t=++$.fn.jexcel.defaults[e].historyIndex,l=$.fn.jexcel.defaults[e].history=$.fn.jexcel.defaults[e].history.slice(0,t+1),n=$(this).find("tbody td.highlight");
l[t]={firstSelected:n[0],lastSelected:n[n.length-1],cellChanges:[]}},discardCurrentHistoryRecord:function(){var e=$(this).prop("id"),t=$.fn.jexcel.defaults[e].historyIndex--;$.fn.jexcel.defaults[e].history=$.fn.jexcel.defaults[e].history.slice(0,t)},storeCellChange:function(e,t,l){var n=$(this),c=$(this).prop("id");$.each(e,function(e,i){l||(l=$(n).jexcel("getValue",i)),$.fn.jexcel.defaults[c].history[$.fn.jexcel.defaults[c].historyIndex].cellChanges.push({cell:$(i),newValue:t,oldValue:l})})},undo:function(){var e=$(this).prop("id");if($.fn.jexcel.defaults[e].historyIndex>=0){for(var t=$.fn.jexcel.defaults[e].history[$.fn.jexcel.defaults[e].historyIndex--],l=0;l<t.cellChanges.length;l++)$(this).jexcel("setValue",$(t.cellChanges[l].cell),t.cellChanges[l].oldValue,!0);$(this).jexcel("updateSelection",t.firstSelected,t.lastSelected)}},redo:function(){var e=$(this).prop("id");if($.fn.jexcel.defaults[e].historyIndex<$.fn.jexcel.defaults[e].history.length-1){for(var t=$.fn.jexcel.defaults[e].history[++$.fn.jexcel.defaults[e].historyIndex],l=0;l<t.cellChanges.length;l++)$(this).jexcel("setValue",$(t.cellChanges[l].cell),t.cellChanges[l].newValue,!0);$(this).jexcel("updateSelection",t.firstSelected,t.lastSelected)}},createCell:function(e,t){var l=$(this).prop("id"),n=$.fn.jexcel.defaults[l];return align=n.colAlignments[e],width=n.colWidths[e],td=document.createElement("td"),$(td).prop("width",width),$(td).prop("align",align),$(td).prop("id",e+"-"+t),$(td).addClass("c"+e),$(td).addClass("r"+t),"hidden"==n.columns[e].type?$(td).css("display","none"):"checkbox"==n.columns[e].type&&(1==n.columns[e].readOnly?$(td).html('<input type="checkbox" disabled="disabled">'):$(td).html("<input type=\"checkbox\" onclick=\"var instance = $(this).parents('.jexcel').parent(); $(instance).jexcel('setValue', $(this).parent(), $(this).prop('checked') ? 1 : 0)\">")),$(this).jexcel("setValue",$(td),""+n.data[t][e],!0),1==n.columns[e].readOnly&&$(td).addClass("readonly","readonly"),$(td)},getColumnName:function(e){var t="";return e>701?(t+=String.fromCharCode(64+parseInt(e/676)),t+=String.fromCharCode(64+parseInt(e%676/26))):e>25&&(t+=String.fromCharCode(64+parseInt(e/26))),t+=String.fromCharCode(65+e%26)},getIdFromColumnName:function(e){var t=/^[a-zA-Z]+/.exec(e);if(t){for(var l=0,n=0;n<t[0].length;n++)l+=parseInt(t[0].charCodeAt(n)-65);e=l+"-"+(parseInt(/[0-9]+$/.exec(e))-1)}return e},getColumnNameFromId:function(e){var t=e.split("-");return $.fn.jexcel("getColumnName",t[0])+(parseInt(t[1])+1)}};$.fn.jexcel=function(e){return methods[e]?methods[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void $.error("Method "+e+" does not exist on jQuery.tooltip"):methods.init.apply(this,arguments)}}(jQuery);